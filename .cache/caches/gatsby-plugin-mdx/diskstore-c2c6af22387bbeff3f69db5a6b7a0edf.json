{"expireTime":9007200856297953000,"key":"gatsby-plugin-mdx-entire-payload-48c3cd67e7cce65b1b26b7b9d3771abe-","val":{"mdast":{"type":"root","children":[{"type":"heading","depth":1,"children":[{"type":"text","value":"Auditing Executive Spells","position":{"start":{"line":1,"column":3,"offset":2},"end":{"line":1,"column":28,"offset":27},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":28,"offset":27},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"This is intended as a guide to help MKR Holders verify executive spells in the Maker Protocol before they vote for them. This document contains three main sections. ","position":{"start":{"line":3,"column":1,"offset":29},"end":{"line":3,"column":166,"offset":194},"indent":[]}}],"position":{"start":{"line":3,"column":1,"offset":29},"end":{"line":3,"column":166,"offset":194},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"First, finding the Contract Code deals with locating the code for the executive in question.","position":{"start":{"line":5,"column":1,"offset":196},"end":{"line":5,"column":93,"offset":288},"indent":[]}}],"position":{"start":{"line":5,"column":1,"offset":196},"end":{"line":5,"column":93,"offset":288},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Second, anatomy of a Spell Contract shows examples of the main sections you should expect to see in an executive spell.","position":{"start":{"line":7,"column":1,"offset":290},"end":{"line":7,"column":120,"offset":409},"indent":[]}}],"position":{"start":{"line":7,"column":1,"offset":290},"end":{"line":7,"column":120,"offset":409},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Finally, A Non-Exhaustive checklist includes a list of the major things to double check and how to do so.","position":{"start":{"line":9,"column":1,"offset":411},"end":{"line":9,"column":106,"offset":516},"indent":[]}}],"position":{"start":{"line":9,"column":1,"offset":411},"end":{"line":9,"column":106,"offset":516},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The key thing to remember is that if any part of an executive spell seems suspicious or confusing in any way it is ","position":{"start":{"line":11,"column":1,"offset":518},"end":{"line":11,"column":116,"offset":633},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"always","position":{"start":{"line":11,"column":118,"offset":635},"end":{"line":11,"column":124,"offset":641},"indent":[]}}],"position":{"start":{"line":11,"column":116,"offset":633},"end":{"line":11,"column":126,"offset":643},"indent":[]}},{"type":"text","value":" better to double check before voting. Even if you are mistaken in your concerns, this allows us to add more detail to this document to prevent someone becoming confused in the same way in the future.","position":{"start":{"line":11,"column":126,"offset":643},"end":{"line":11,"column":326,"offset":843},"indent":[]}}],"position":{"start":{"line":11,"column":1,"offset":518},"end":{"line":11,"column":326,"offset":843},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Finding the Contract Code","position":{"start":{"line":13,"column":4,"offset":848},"end":{"line":13,"column":29,"offset":873},"indent":[]}}],"position":{"start":{"line":13,"column":1,"offset":845},"end":{"line":13,"column":29,"offset":873},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The link to the spell on etherscan can be found on the ","position":{"start":{"line":15,"column":1,"offset":875},"end":{"line":15,"column":56,"offset":930},"indent":[]}},{"type":"link","title":null,"url":"https://vote.makerdao.com/","children":[{"type":"text","value":"voting portal","position":{"start":{"line":15,"column":57,"offset":931},"end":{"line":15,"column":70,"offset":944},"indent":[]}}],"position":{"start":{"line":15,"column":56,"offset":930},"end":{"line":15,"column":99,"offset":973},"indent":[]}},{"type":"text","value":" in the 'details' pane. Look for the 'source' property.","position":{"start":{"line":15,"column":99,"offset":973},"end":{"line":15,"column":154,"offset":1028},"indent":[]}}],"position":{"start":{"line":15,"column":1,"offset":875},"end":{"line":15,"column":154,"offset":1028},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Once you open the spell in etherscan, click on the Contract tab.","position":{"start":{"line":17,"column":1,"offset":1030},"end":{"line":17,"column":65,"offset":1094},"indent":[]}}],"position":{"start":{"line":17,"column":1,"offset":1030},"end":{"line":17,"column":65,"offset":1094},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"You should see the contract code now. If you are only able to see bytecode (contract is unverified) then the executive should be viewed as potentially malicious. In this case, cry foul in ","position":{"start":{"line":19,"column":1,"offset":1096},"end":{"line":19,"column":189,"offset":1284},"indent":[]}},{"type":"link","title":null,"url":"https://chat.makerdao.com/channel/governance-and-risk","children":[{"type":"text","value":"chat","position":{"start":{"line":19,"column":190,"offset":1285},"end":{"line":19,"column":194,"offset":1289},"indent":[]}}],"position":{"start":{"line":19,"column":189,"offset":1284},"end":{"line":19,"column":250,"offset":1345},"indent":[]}},{"type":"text","value":" and encourage people NOT to vote for it until the contract code is made available.","position":{"start":{"line":19,"column":250,"offset":1345},"end":{"line":19,"column":333,"offset":1428},"indent":[]}}],"position":{"start":{"line":19,"column":1,"offset":1096},"end":{"line":19,"column":333,"offset":1428},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"For this document, we will be looking at this executive as our source for examples:\n","position":{"start":{"line":21,"column":1,"offset":1430},"end":{"line":22,"column":1,"offset":1514},"indent":[1]}},{"type":"link","title":null,"url":"https://etherscan.io/address/0xD24FbbB4497AD32308BDa735683B55499Ddc2CaD","children":[{"type":"text","value":"https://etherscan.io/address/0xD24FbbB4497AD32308BDa735683B55499Ddc2CaD","position":{"start":{"line":22,"column":1,"offset":1514},"end":{"line":22,"column":72,"offset":1585},"indent":[]}}],"position":{"start":{"line":22,"column":1,"offset":1514},"end":{"line":22,"column":72,"offset":1585},"indent":[]}}],"position":{"start":{"line":21,"column":1,"offset":1430},"end":{"line":22,"column":72,"offset":1585},"indent":[1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Anatomy of an Executive","position":{"start":{"line":24,"column":4,"offset":1590},"end":{"line":24,"column":27,"offset":1613},"indent":[]}}],"position":{"start":{"line":24,"column":1,"offset":1587},"end":{"line":24,"column":27,"offset":1613},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The meat of each spell is located near the bottom. Most of the stuff at the top are flattened libraries included when the contract was verified.","position":{"start":{"line":26,"column":1,"offset":1615},"end":{"line":26,"column":145,"offset":1759},"indent":[]}}],"position":{"start":{"line":26,"column":1,"offset":1615},"end":{"line":26,"column":145,"offset":1759},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"There are two contracts of note in each executive. These are the ","position":{"start":{"line":28,"column":1,"offset":1761},"end":{"line":28,"column":66,"offset":1826},"indent":[]}},{"type":"inlineCode","value":"DssSpell","position":{"start":{"line":28,"column":66,"offset":1826},"end":{"line":28,"column":76,"offset":1836},"indent":[]}},{"type":"text","value":" contract and the ","position":{"start":{"line":28,"column":76,"offset":1836},"end":{"line":28,"column":94,"offset":1854},"indent":[]}},{"type":"inlineCode","value":"SpellAction","position":{"start":{"line":28,"column":94,"offset":1854},"end":{"line":28,"column":107,"offset":1867},"indent":[]}},{"type":"text","value":" contract.","position":{"start":{"line":28,"column":107,"offset":1867},"end":{"line":28,"column":117,"offset":1877},"indent":[]}}],"position":{"start":{"line":28,"column":1,"offset":1761},"end":{"line":28,"column":117,"offset":1877},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"In our example, the ","position":{"start":{"line":30,"column":1,"offset":1879},"end":{"line":30,"column":21,"offset":1899},"indent":[]}},{"type":"inlineCode","value":"DssSpell","position":{"start":{"line":30,"column":21,"offset":1899},"end":{"line":30,"column":31,"offset":1909},"indent":[]}},{"type":"text","value":" contract is named ","position":{"start":{"line":30,"column":31,"offset":1909},"end":{"line":30,"column":50,"offset":1928},"indent":[]}},{"type":"inlineCode","value":"DssSpell20200221","position":{"start":{"line":30,"column":50,"offset":1928},"end":{"line":30,"column":68,"offset":1946},"indent":[]}},{"type":"text","value":" in this example and is located at the bottom of the file. Once this spell ","position":{"start":{"line":30,"column":68,"offset":1946},"end":{"line":30,"column":143,"offset":2021},"indent":[]}},{"type":"inlineCode","value":"0xD24FbbB4497AD32308BDa735683B55499Ddc2CaD","position":{"start":{"line":30,"column":143,"offset":2021},"end":{"line":30,"column":187,"offset":2065},"indent":[]}},{"type":"text","value":" gets enough votes to be ","position":{"start":{"line":30,"column":187,"offset":2065},"end":{"line":30,"column":212,"offset":2090},"indent":[]}},{"type":"inlineCode","value":"lifted","position":{"start":{"line":30,"column":212,"offset":2090},"end":{"line":30,"column":220,"offset":2098},"indent":[]}},{"type":"text","value":" to the ","position":{"start":{"line":30,"column":220,"offset":2098},"end":{"line":30,"column":228,"offset":2106},"indent":[]}},{"type":"inlineCode","value":"hat","position":{"start":{"line":30,"column":228,"offset":2106},"end":{"line":30,"column":233,"offset":2111},"indent":[]}},{"type":"text","value":", the ","position":{"start":{"line":30,"column":233,"offset":2111},"end":{"line":30,"column":239,"offset":2117},"indent":[]}},{"type":"inlineCode","value":"schedule()","position":{"start":{"line":30,"column":239,"offset":2117},"end":{"line":30,"column":251,"offset":2129},"indent":[]}},{"type":"text","value":" function you see here will be called.","position":{"start":{"line":30,"column":251,"offset":2129},"end":{"line":30,"column":289,"offset":2167},"indent":[]}}],"position":{"start":{"line":30,"column":1,"offset":1879},"end":{"line":30,"column":289,"offset":2167},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The spell action contract on the other hand includes the ","position":{"start":{"line":32,"column":1,"offset":2169},"end":{"line":32,"column":58,"offset":2226},"indent":[]}},{"type":"inlineCode","value":"execute()","position":{"start":{"line":32,"column":58,"offset":2226},"end":{"line":32,"column":69,"offset":2237},"indent":[]}},{"type":"text","value":" function. This function contains the MCD variable changes that are included in the executive.","position":{"start":{"line":32,"column":69,"offset":2237},"end":{"line":32,"column":163,"offset":2331},"indent":[]}}],"position":{"start":{"line":32,"column":1,"offset":2169},"end":{"line":32,"column":163,"offset":2331},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"DssSpell","position":{"start":{"line":34,"column":5,"offset":2337},"end":{"line":34,"column":13,"offset":2345},"indent":[]}}],"position":{"start":{"line":34,"column":1,"offset":2333},"end":{"line":34,"column":13,"offset":2345},"indent":[]}},{"type":"heading","depth":4,"children":[{"type":"text","value":"Contract Variables","position":{"start":{"line":36,"column":6,"offset":2352},"end":{"line":36,"column":24,"offset":2370},"indent":[]}}],"position":{"start":{"line":36,"column":1,"offset":2347},"end":{"line":36,"column":24,"offset":2370},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Each contract will contain a number of variables to be used in the other functions. In our example, this section looks like this:","position":{"start":{"line":37,"column":1,"offset":2371},"end":{"line":37,"column":130,"offset":2500},"indent":[]}}],"position":{"start":{"line":37,"column":1,"offset":2371},"end":{"line":37,"column":130,"offset":2500},"indent":[]}},{"type":"code","lang":null,"meta":null,"value":"    DSPauseAbstract  public pause =\n        DSPauseAbstract(0xbE286431454714F511008713973d3B053A2d38f3);\n    address constant public SAIMOM = 0xF2C5369cFFb8Ea6284452b0326e326DbFdCb867C;\n    uint256 constant public NEW_FEE = 1000000002877801985002875644; // 9.5%\n    address          public action;\n    bytes32          public tag;\n    uint256          public eta;\n    bytes            public sig;\n    bool             public done;","position":{"start":{"line":39,"column":1,"offset":2502},"end":{"line":49,"column":4,"offset":2940},"indent":[1,1,1,1,1,1,1,1,1,1]}},{"type":"heading","depth":4,"children":[{"type":"text","value":"Constructor","position":{"start":{"line":52,"column":6,"offset":2948},"end":{"line":52,"column":17,"offset":2959},"indent":[]}}],"position":{"start":{"line":52,"column":1,"offset":2943},"end":{"line":52,"column":18,"offset":2960},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The constructor should always look the same:","position":{"start":{"line":54,"column":1,"offset":2962},"end":{"line":54,"column":45,"offset":3006},"indent":[]}}],"position":{"start":{"line":54,"column":1,"offset":2962},"end":{"line":54,"column":45,"offset":3006},"indent":[]}},{"type":"code","lang":null,"meta":null,"value":"    constructor() public {\n        sig = abi.encodeWithSignature(\"execute()\");\n        action = address(new SpellAction());\n        bytes32 _tag;\n        address _action = action;\n        assembly { _tag := extcodehash(_action) }\n        tag = _tag\n    }","position":{"start":{"line":55,"column":1,"offset":3007},"end":{"line":64,"column":4,"offset":3269},"indent":[1,1,1,1,1,1,1,1,1]}},{"type":"heading","depth":4,"children":[{"type":"text","value":"Schedule and Cast","position":{"start":{"line":66,"column":6,"offset":3276},"end":{"line":66,"column":23,"offset":3293},"indent":[]}}],"position":{"start":{"line":66,"column":1,"offset":3271},"end":{"line":66,"column":23,"offset":3293},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":68,"column":1,"offset":3295},"end":{"line":68,"column":5,"offset":3299},"indent":[]}},{"type":"inlineCode","value":"schedule","position":{"start":{"line":68,"column":5,"offset":3299},"end":{"line":68,"column":15,"offset":3309},"indent":[]}},{"type":"text","value":" and ","position":{"start":{"line":68,"column":15,"offset":3309},"end":{"line":68,"column":20,"offset":3314},"indent":[]}},{"type":"inlineCode","value":"cast","position":{"start":{"line":68,"column":20,"offset":3314},"end":{"line":68,"column":26,"offset":3320},"indent":[]}},{"type":"text","value":" functions will usually be the same, but for now any SCD changes will be tucked into ","position":{"start":{"line":68,"column":26,"offset":3320},"end":{"line":68,"column":111,"offset":3405},"indent":[]}},{"type":"inlineCode","value":"schedule","position":{"start":{"line":68,"column":111,"offset":3405},"end":{"line":68,"column":121,"offset":3415},"indent":[]}},{"type":"text","value":". If they deviate from the following, it will be commented:","position":{"start":{"line":68,"column":121,"offset":3415},"end":{"line":68,"column":180,"offset":3474},"indent":[]}}],"position":{"start":{"line":68,"column":1,"offset":3295},"end":{"line":68,"column":180,"offset":3474},"indent":[]}},{"type":"code","lang":null,"meta":null,"value":"    function schedule() public {\n        require(eta == 0, \"spell-already-scheduled\");\n        eta = add(now, DSPauseAbstract(pause).delay());\n        pause.plot(action, tag, sig, eta);\n    }\n\n    function cast() public {\n        require(!done, \"spell-already-cast\");\n        done = true;\n        pause.exec(action, tag, sig, eta);\n    }","position":{"start":{"line":69,"column":1,"offset":3475},"end":{"line":81,"column":4,"offset":3820},"indent":[1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"After ","position":{"start":{"line":83,"column":1,"offset":3822},"end":{"line":83,"column":7,"offset":3828},"indent":[]}},{"type":"inlineCode","value":"schedule()","position":{"start":{"line":83,"column":7,"offset":3828},"end":{"line":83,"column":19,"offset":3840},"indent":[]}},{"type":"text","value":" has been called and after the delay is up, anyone can call ","position":{"start":{"line":83,"column":19,"offset":3840},"end":{"line":83,"column":79,"offset":3900},"indent":[]}},{"type":"inlineCode","value":"cast()","position":{"start":{"line":83,"column":79,"offset":3900},"end":{"line":83,"column":87,"offset":3908},"indent":[]}},{"type":"text","value":" which will execute the code in the SpellAction's ","position":{"start":{"line":83,"column":87,"offset":3908},"end":{"line":83,"column":137,"offset":3958},"indent":[]}},{"type":"inlineCode","value":"execute()","position":{"start":{"line":83,"column":137,"offset":3958},"end":{"line":83,"column":148,"offset":3969},"indent":[]}},{"type":"text","value":" function (see below). ","position":{"start":{"line":83,"column":148,"offset":3969},"end":{"line":83,"column":171,"offset":3992},"indent":[]}}],"position":{"start":{"line":83,"column":1,"offset":3822},"end":{"line":83,"column":171,"offset":3992},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"SpellAction","position":{"start":{"line":86,"column":5,"offset":3999},"end":{"line":86,"column":16,"offset":4010},"indent":[]}}],"position":{"start":{"line":86,"column":1,"offset":3995},"end":{"line":86,"column":16,"offset":4010},"indent":[]}},{"type":"heading","depth":4,"children":[{"type":"text","value":"Contract Variables","position":{"start":{"line":88,"column":6,"offset":4017},"end":{"line":88,"column":24,"offset":4035},"indent":[]}}],"position":{"start":{"line":88,"column":1,"offset":4012},"end":{"line":88,"column":24,"offset":4035},"indent":[]}},{"type":"code","lang":null,"meta":null,"value":"uint256 constant RAD = 10 ** 45;\naddress constant public PAUSE = 0xbE286431454714F511008713973d3B053A2d38f3;\naddress constant public CHIEF = 0x9eF05f7F6deB616fd37aC3c959a2dDD25A54E4F5;\naddress constant public OSM_MOM = 0x76416A4d5190d071bfed309861527431304aA14f;\naddress constant public ETH_OSM = 0x81FE72B5A8d1A857d176C3E7d5Bd2679A9B85763;\naddress constant public BAT_OSM = 0xB4eb54AF9Cc7882DF0121d26c5b97E802915ABe6;\naddress constant public VAT = 0x35D1b3F3D7966A1DFe207aa4514C12a259A0492B;\naddress constant public JUG = 0x19c0976f590D67707E62397C87829d896Dc0f1F1;\naddress constant public POT = 0x197E90f9FAD81970bA7976f33CbD77088E5D7cf7;\naddress constant public FLAP = 0xdfE0fb1bE2a52CDBf8FB962D5701d7fd0902db9f;\nuint256 constant NEW_BEG = 1.02E18; // 2%","position":{"start":{"line":90,"column":1,"offset":4037},"end":{"line":102,"column":4,"offset":4802},"indent":[1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"NOTE:","position":{"start":{"line":104,"column":3,"offset":4806},"end":{"line":104,"column":8,"offset":4811},"indent":[]}}],"position":{"start":{"line":104,"column":1,"offset":4804},"end":{"line":104,"column":10,"offset":4813},"indent":[]}},{"type":"text","value":" Review \"All SpellAction Contract Variables must be declared 'constant'\" in the checklist section below.","position":{"start":{"line":104,"column":10,"offset":4813},"end":{"line":104,"column":114,"offset":4917},"indent":[]}}],"position":{"start":{"line":104,"column":1,"offset":4804},"end":{"line":104,"column":114,"offset":4917},"indent":[]}},{"type":"heading","depth":4,"children":[{"type":"text","value":"Execute","position":{"start":{"line":106,"column":6,"offset":4924},"end":{"line":106,"column":13,"offset":4931},"indent":[]}}],"position":{"start":{"line":106,"column":1,"offset":4919},"end":{"line":106,"column":13,"offset":4931},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":107,"column":1,"offset":4932},"end":{"line":107,"column":5,"offset":4936},"indent":[]}},{"type":"inlineCode","value":"execute()","position":{"start":{"line":107,"column":5,"offset":4936},"end":{"line":107,"column":16,"offset":4947},"indent":[]}},{"type":"text","value":" function will contain each MCD change that is being made in this executive spell.","position":{"start":{"line":107,"column":16,"offset":4947},"end":{"line":107,"column":98,"offset":5029},"indent":[]}}],"position":{"start":{"line":107,"column":1,"offset":4932},"end":{"line":107,"column":98,"offset":5029},"indent":[]}},{"type":"code","lang":null,"meta":null,"value":"    function execute() external {\n        // drip\n        PotAbstract(POT).drip();\n        JugAbstract(JUG).drip(\"ETH-A\");\n        JugAbstract(JUG).drip(\"BAT-A\");\n\n        // set the global debt ceiling to 183,000,000\n        VatAbstract(VAT).file(\"Line\", mul(183000000, RAD));\n\n        // set the ETH-A debt ceiling to 150,000,000\n        // https://vote.makerdao.com/polling-proposal/qmsm1q1hohyctsgxpbm44fomjoukf1d5g9lmpqraikmeoc\n        VatAbstract(VAT).file(\"ETH-A\", \"line\", mul(150000000, RAD));\n\n        // No Sai debt ceiling change this week.\n\n        // set dsr to 8.0%\n        // Previously ETH SF was set to 8.0%, no change this week.\n        //  DSR rate was voted to a 0% spread, so we're bringing DSR up to match.\n        // https://vote.makerdao.com/polling-proposal/qmss9hnszwr6egq3xn6gpx4u8bz8cajja56rgtanjev1v8\n        PotAbstract(POT).file(\"dsr\", 1000000002440418608258400030);\n\n        // MCD Stability fee is currently at 8% and remains the same this week.\n        // https://vote.makerdao.com/polling-proposal/qmzgvzjm4xpm4b1tk2hxhdc6p8f4zqyju38pwqieatmhel\n\n        // Lower the minimum flap auction bid increase to 2%\n        // https://vote.makerdao.com/polling-proposal/qmtsxrqavtczfsseytpypgqrz6z8zb613ikxwhqjv9ytzz\n        FlapAbstract(FLAP).file(\"beg\", NEW_BEG);\n\n        // Increase the Pause to 24 Hours\n        OsmAbstract(ETH_OSM).rely(OSM_MOM);\n        OsmAbstract(BAT_OSM).rely(OSM_MOM);\n        OsmMomAbstract(OSM_MOM).setAuthority(CHIEF);\n        OsmMomAbstract(OSM_MOM).setOsm(\"ETH-A\", ETH_OSM);\n        OsmMomAbstract(OSM_MOM).setOsm(\"BAT-A\", BAT_OSM);\n        DSPauseAbstract(PAUSE).setDelay(60 * 60 * 24);\n   }","position":{"start":{"line":109,"column":1,"offset":5031},"end":{"line":146,"column":7,"offset":6693},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":149,"column":1,"offset":6696},"end":{"line":149,"column":5,"offset":6700},"indent":[]}},{"type":"inlineCode","value":"execute()","position":{"start":{"line":149,"column":5,"offset":6700},"end":{"line":149,"column":16,"offset":6711},"indent":[]}},{"type":"text","value":" function will be too large to go into detail, but each change should be well documented and one should make sure the code does what the comment says. ","position":{"start":{"line":149,"column":16,"offset":6711},"end":{"line":149,"column":167,"offset":6862},"indent":[]}}],"position":{"start":{"line":149,"column":1,"offset":6696},"end":{"line":149,"column":167,"offset":6862},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"A Non-exhaustive Checklist","position":{"start":{"line":152,"column":4,"offset":6868},"end":{"line":152,"column":30,"offset":6894},"indent":[]}}],"position":{"start":{"line":152,"column":1,"offset":6865},"end":{"line":152,"column":30,"offset":6894},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Verify that the contract code is visible.","position":{"start":{"line":154,"column":5,"offset":6900},"end":{"line":154,"column":46,"offset":6941},"indent":[]}}],"position":{"start":{"line":154,"column":1,"offset":6896},"end":{"line":154,"column":46,"offset":6941},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Using the instructions above find the contract code on Etherscan and ensure that it is visible and verified.","position":{"start":{"line":156,"column":1,"offset":6943},"end":{"line":156,"column":109,"offset":7051},"indent":[]}}],"position":{"start":{"line":156,"column":1,"offset":6943},"end":{"line":156,"column":109,"offset":7051},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Verify the Constructor, the Schedule, and the Cast functions mach templates.","position":{"start":{"line":158,"column":5,"offset":7057},"end":{"line":158,"column":81,"offset":7133},"indent":[]}}],"position":{"start":{"line":158,"column":1,"offset":7053},"end":{"line":158,"column":81,"offset":7133},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Each of these functions should match the templates shown above unless comments are included with the changes explaining why they do not conform to the expected templates.","position":{"start":{"line":160,"column":1,"offset":7135},"end":{"line":160,"column":171,"offset":7305},"indent":[]}}],"position":{"start":{"line":160,"column":1,"offset":7135},"end":{"line":160,"column":171,"offset":7305},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Verify that the contents of the execute function are as expected","position":{"start":{"line":162,"column":5,"offset":7311},"end":{"line":162,"column":69,"offset":7375},"indent":[]}}],"position":{"start":{"line":162,"column":1,"offset":7307},"end":{"line":162,"column":69,"offset":7375},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Make sure that you are seeing what you expected to see from the voting dashboard. ","position":{"start":{"line":164,"column":1,"offset":7377},"end":{"line":164,"column":83,"offset":7459},"indent":[]}}],"position":{"start":{"line":164,"column":1,"offset":7377},"end":{"line":164,"column":83,"offset":7459},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Ensure that everything present is correct and that nothing is missing from this function.","position":{"start":{"line":166,"column":1,"offset":7461},"end":{"line":166,"column":90,"offset":7550},"indent":[]}}],"position":{"start":{"line":166,"column":1,"offset":7461},"end":{"line":166,"column":90,"offset":7550},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Verify all addresses against the changelog","position":{"start":{"line":168,"column":5,"offset":7556},"end":{"line":168,"column":47,"offset":7598},"indent":[]}}],"position":{"start":{"line":168,"column":1,"offset":7552},"end":{"line":168,"column":47,"offset":7598},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Any addresses you see in either of the above contracts should be verified against the most recent mainnet changelog.  Currently MCD is at version ","position":{"start":{"line":170,"column":1,"offset":7600},"end":{"line":170,"column":147,"offset":7746},"indent":[]}},{"type":"inlineCode","value":"1.0.5","position":{"start":{"line":170,"column":147,"offset":7746},"end":{"line":170,"column":154,"offset":7753},"indent":[]}},{"type":"text","value":", and the address list can be found here:\n","position":{"start":{"line":170,"column":154,"offset":7753},"end":{"line":171,"column":1,"offset":7795},"indent":[1]}},{"type":"link","title":null,"url":"https://changelog.makerdao.com/releases/mainnet/1.0.5/contracts.json","children":[{"type":"text","value":"https://changelog.makerdao.com/releases/mainnet/1.0.5/contracts.json","position":{"start":{"line":171,"column":1,"offset":7795},"end":{"line":171,"column":69,"offset":7863},"indent":[]}}],"position":{"start":{"line":171,"column":1,"offset":7795},"end":{"line":171,"column":69,"offset":7863},"indent":[]}}],"position":{"start":{"line":170,"column":1,"offset":7600},"end":{"line":171,"column":69,"offset":7863},"indent":[1]}},{"type":"paragraph","children":[{"type":"text","value":"To find the latest release you can look at ","position":{"start":{"line":173,"column":1,"offset":7865},"end":{"line":173,"column":44,"offset":7908},"indent":[]}},{"type":"link","title":null,"url":"https://changelog.makerdao.com/","children":[{"type":"text","value":"https://changelog.makerdao.com/","position":{"start":{"line":173,"column":44,"offset":7908},"end":{"line":173,"column":75,"offset":7939},"indent":[]}}],"position":{"start":{"line":173,"column":44,"offset":7908},"end":{"line":173,"column":75,"offset":7939},"indent":[]}}],"position":{"start":{"line":173,"column":1,"offset":7865},"end":{"line":173,"column":75,"offset":7939},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"In order to verify these, you should ensure that each address in the contract matches one of the addresses in the changelog.","position":{"start":{"line":175,"column":1,"offset":7941},"end":{"line":175,"column":125,"offset":8065},"indent":[]}}],"position":{"start":{"line":175,"column":1,"offset":7941},"end":{"line":175,"column":125,"offset":8065},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Note that in the example spell, there were SCD changes. Those are well documented and done with SaiMomAbstract(SAIMOM).setFee(NEW_FEE);. This calls a contract that has privileged access to make a few configuration changes in SCD. ","position":{"start":{"line":177,"column":1,"offset":8067},"end":{"line":177,"column":231,"offset":8297},"indent":[]}}],"position":{"start":{"line":177,"column":1,"offset":8067},"end":{"line":177,"column":231,"offset":8297},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Verify the address of ","position":{"start":{"line":179,"column":1,"offset":8299},"end":{"line":179,"column":23,"offset":8321},"indent":[]}},{"type":"inlineCode","value":"SAIMOM","position":{"start":{"line":179,"column":23,"offset":8321},"end":{"line":179,"column":31,"offset":8329},"indent":[]}},{"type":"text","value":" from the contract definition above. This is trickier, but you can put the ","position":{"start":{"line":179,"column":31,"offset":8329},"end":{"line":179,"column":106,"offset":8404},"indent":[]}},{"type":"inlineCode","value":"SAIMOM","position":{"start":{"line":179,"column":106,"offset":8404},"end":{"line":179,"column":114,"offset":8412},"indent":[]}},{"type":"text","value":" address into etherscan: ","position":{"start":{"line":179,"column":114,"offset":8412},"end":{"line":179,"column":139,"offset":8437},"indent":[]}},{"type":"link","title":null,"url":"https://etherscan.io/address/0xF2C5369cFFb8Ea6284452b0326e326DbFdCb867C#code","children":[{"type":"text","value":"https://etherscan.io/address/0xF2C5369cFFb8Ea6284452b0326e326DbFdCb867C#code","position":{"start":{"line":179,"column":139,"offset":8437},"end":{"line":179,"column":215,"offset":8513},"indent":[]}}],"position":{"start":{"line":179,"column":139,"offset":8437},"end":{"line":179,"column":215,"offset":8513},"indent":[]}}],"position":{"start":{"line":179,"column":1,"offset":8299},"end":{"line":179,"column":215,"offset":8513},"indent":[]}},{"type":"heading","depth":4,"children":[{"type":"text","value":"Verifying Oracle Addresses","position":{"start":{"line":181,"column":6,"offset":8520},"end":{"line":181,"column":32,"offset":8546},"indent":[]}}],"position":{"start":{"line":181,"column":1,"offset":8515},"end":{"line":181,"column":32,"offset":8546},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Occasionally, there are spells to do with Oracles - generally adding addresses to the whitelist, and occasionally adding a new kind of oracle (most recently the BTCUSD one). These addresses must also be carefully verified, and it can be non-obvious how to do so. However, if you follow the ","position":{"start":{"line":183,"column":1,"offset":8548},"end":{"line":183,"column":291,"offset":8838},"indent":[]}},{"type":"link","title":null,"url":"https://changelog.makerdao.com/releases/mainnet/1.0.5/contracts.json","children":[{"type":"text","value":"link to the changelog","position":{"start":{"line":183,"column":292,"offset":8839},"end":{"line":183,"column":313,"offset":8860},"indent":[]}}],"position":{"start":{"line":183,"column":291,"offset":8838},"end":{"line":183,"column":384,"offset":8931},"indent":[]}},{"type":"text","value":" and look for ","position":{"start":{"line":183,"column":384,"offset":8931},"end":{"line":183,"column":398,"offset":8945},"indent":[]}},{"type":"inlineCode","value":"PIP_ETH","position":{"start":{"line":183,"column":398,"offset":8945},"end":{"line":183,"column":407,"offset":8954},"indent":[]}},{"type":"text","value":", you'll be on the right track.","position":{"start":{"line":183,"column":407,"offset":8954},"end":{"line":183,"column":438,"offset":8985},"indent":[]}}],"position":{"start":{"line":183,"column":1,"offset":8548},"end":{"line":183,"column":438,"offset":8985},"indent":[]}},{"type":"list","ordered":true,"start":1,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Open the ","position":{"start":{"line":185,"column":4,"offset":8990},"end":{"line":185,"column":13,"offset":8999},"indent":[]}},{"type":"inlineCode","value":"Read","position":{"start":{"line":185,"column":13,"offset":8999},"end":{"line":185,"column":19,"offset":9005},"indent":[]}},{"type":"text","value":" tab of the ","position":{"start":{"line":185,"column":19,"offset":9005},"end":{"line":185,"column":31,"offset":9017},"indent":[]}},{"type":"link","title":null,"url":"https://etherscan.io/address/0x81FE72B5A8d1A857d176C3E7d5Bd2679A9B85763#code","children":[{"type":"inlineCode","value":"PIP_ETH","position":{"start":{"line":185,"column":32,"offset":9018},"end":{"line":185,"column":41,"offset":9027},"indent":[]}}],"position":{"start":{"line":185,"column":31,"offset":9017},"end":{"line":185,"column":120,"offset":9106},"indent":[]}},{"type":"text","value":" contract.","position":{"start":{"line":185,"column":120,"offset":9106},"end":{"line":185,"column":130,"offset":9116},"indent":[]}}],"position":{"start":{"line":185,"column":4,"offset":8990},"end":{"line":185,"column":130,"offset":9116},"indent":[]}}],"position":{"start":{"line":185,"column":1,"offset":8987},"end":{"line":185,"column":130,"offset":9116},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Look for ","position":{"start":{"line":186,"column":4,"offset":9120},"end":{"line":186,"column":13,"offset":9129},"indent":[]}},{"type":"inlineCode","value":"src","position":{"start":{"line":186,"column":13,"offset":9129},"end":{"line":186,"column":18,"offset":9134},"indent":[]}},{"type":"text","value":" (listed as number ","position":{"start":{"line":186,"column":18,"offset":9134},"end":{"line":186,"column":37,"offset":9153},"indent":[]}},{"type":"inlineCode","value":"7","position":{"start":{"line":186,"column":37,"offset":9153},"end":{"line":186,"column":40,"offset":9156},"indent":[]}},{"type":"text","value":" currently).","position":{"start":{"line":186,"column":40,"offset":9156},"end":{"line":186,"column":52,"offset":9168},"indent":[]}}],"position":{"start":{"line":186,"column":4,"offset":9120},"end":{"line":186,"column":52,"offset":9168},"indent":[]}}],"position":{"start":{"line":186,"column":1,"offset":9117},"end":{"line":186,"column":52,"offset":9168},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Follow ","position":{"start":{"line":187,"column":4,"offset":9172},"end":{"line":187,"column":11,"offset":9179},"indent":[]}},{"type":"link","title":null,"url":"https://etherscan.io/address/0x64de91f5a373cd4c28de3600cb34c7c6ce410c85#code","children":[{"type":"text","value":"the contract address listed there","position":{"start":{"line":187,"column":12,"offset":9180},"end":{"line":187,"column":45,"offset":9213},"indent":[]}}],"position":{"start":{"line":187,"column":11,"offset":9179},"end":{"line":187,"column":124,"offset":9292},"indent":[]}},{"type":"text","value":" and verify that it is indeed the ","position":{"start":{"line":187,"column":124,"offset":9292},"end":{"line":187,"column":158,"offset":9326},"indent":[]}},{"type":"inlineCode","value":"MedianETHUSD","position":{"start":{"line":187,"column":158,"offset":9326},"end":{"line":187,"column":172,"offset":9340},"indent":[]}},{"type":"text","value":"contract, and that the address here matches what is in the spell.","position":{"start":{"line":187,"column":172,"offset":9340},"end":{"line":187,"column":237,"offset":9405},"indent":[]}}],"position":{"start":{"line":187,"column":4,"offset":9172},"end":{"line":187,"column":237,"offset":9405},"indent":[]}}],"position":{"start":{"line":187,"column":1,"offset":9169},"end":{"line":187,"column":237,"offset":9405},"indent":[]}}],"position":{"start":{"line":185,"column":1,"offset":8987},"end":{"line":187,"column":237,"offset":9405},"indent":[1,1]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Verify Rate Changes","position":{"start":{"line":189,"column":5,"offset":9411},"end":{"line":189,"column":24,"offset":9430},"indent":[]}}],"position":{"start":{"line":189,"column":1,"offset":9407},"end":{"line":189,"column":24,"offset":9430},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Rates are defined as per-second accumulation values. These values can be validated against the commented rate by using the ","position":{"start":{"line":191,"column":1,"offset":9432},"end":{"line":191,"column":124,"offset":9555},"indent":[]}},{"type":"inlineCode","value":"bc","position":{"start":{"line":191,"column":124,"offset":9555},"end":{"line":191,"column":128,"offset":9559},"indent":[]}},{"type":"text","value":" command in a ","position":{"start":{"line":191,"column":128,"offset":9559},"end":{"line":191,"column":142,"offset":9573},"indent":[]}},{"type":"inlineCode","value":"bash","position":{"start":{"line":191,"column":142,"offset":9573},"end":{"line":191,"column":148,"offset":9579},"indent":[]}},{"type":"text","value":" shell. Using the NEW_FEE variable in the example contract we have:","position":{"start":{"line":191,"column":148,"offset":9579},"end":{"line":191,"column":215,"offset":9646},"indent":[]}}],"position":{"start":{"line":191,"column":1,"offset":9432},"end":{"line":191,"column":215,"offset":9646},"indent":[]}},{"type":"code","lang":null,"meta":null,"value":"bc -l <<< 'scale=27; e( l(1.095)/(60 * 60 * 24 * 365) )'","position":{"start":{"line":193,"column":1,"offset":9648},"end":{"line":195,"column":4,"offset":9712},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"This produces ","position":{"start":{"line":197,"column":1,"offset":9714},"end":{"line":197,"column":15,"offset":9728},"indent":[]}},{"type":"inlineCode","value":"1.000000002877801985002875644","position":{"start":{"line":197,"column":15,"offset":9728},"end":{"line":197,"column":46,"offset":9759},"indent":[]}},{"type":"text","value":", just drop the decimal place and you can see this matches the definition of ","position":{"start":{"line":197,"column":46,"offset":9759},"end":{"line":197,"column":123,"offset":9836},"indent":[]}},{"type":"inlineCode","value":"NEW_FEE","position":{"start":{"line":197,"column":123,"offset":9836},"end":{"line":197,"column":132,"offset":9845},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":197,"column":132,"offset":9845},"end":{"line":197,"column":133,"offset":9846},"indent":[]}}],"position":{"start":{"line":197,"column":1,"offset":9714},"end":{"line":197,"column":133,"offset":9846},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Validating all rate adjustments can be done the same way.","position":{"start":{"line":199,"column":1,"offset":9848},"end":{"line":199,"column":58,"offset":9905},"indent":[]}}],"position":{"start":{"line":199,"column":1,"offset":9848},"end":{"line":199,"column":58,"offset":9905},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"For more information on the rates module, @vamsi wrote up a great post here: ","position":{"start":{"line":201,"column":1,"offset":9907},"end":{"line":201,"column":78,"offset":9984},"indent":[]}},{"type":"link","title":null,"url":"https://github.com/makerdao/developerguides/blob/master/mcd/intro-rate-mechanism/intro-rate-mechanism.mdare","children":[{"type":"text","value":"https://github.com/makerdao/developerguides/blob/master/mcd/intro-rate-mechanism/intro-rate-mechanism.mdare","position":{"start":{"line":201,"column":78,"offset":9984},"end":{"line":201,"column":185,"offset":10091},"indent":[]}}],"position":{"start":{"line":201,"column":78,"offset":9984},"end":{"line":201,"column":185,"offset":10091},"indent":[]}},{"type":"text","value":" set to go off","position":{"start":{"line":201,"column":185,"offset":10091},"end":{"line":201,"column":199,"offset":10105},"indent":[]}}],"position":{"start":{"line":201,"column":1,"offset":9907},"end":{"line":201,"column":199,"offset":10105},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Verify Timing","position":{"start":{"line":203,"column":5,"offset":10111},"end":{"line":203,"column":18,"offset":10124},"indent":[]}}],"position":{"start":{"line":203,"column":1,"offset":10107},"end":{"line":203,"column":18,"offset":10124},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Occasionally, spells are set to execute at specific times, as in the case of ","position":{"start":{"line":205,"column":1,"offset":10126},"end":{"line":205,"column":78,"offset":10203},"indent":[]}},{"type":"link","title":null,"url":"https://etherscan.io/address/0x3526A5858Aa91C058A7084ae8AB6d323D2BaeBB8#code","children":[{"type":"text","value":"shutting down SCD","position":{"start":{"line":205,"column":79,"offset":10204},"end":{"line":205,"column":96,"offset":10221},"indent":[]}}],"position":{"start":{"line":205,"column":78,"offset":10203},"end":{"line":205,"column":175,"offset":10300},"indent":[]}},{"type":"text","value":" (check line 71 for an example). You can verify any UTC timestamp created in such spells using ","position":{"start":{"line":205,"column":175,"offset":10300},"end":{"line":205,"column":270,"offset":10395},"indent":[]}},{"type":"link","title":null,"url":"https://www.unixtimestamp.com/index.php","children":[{"type":"text","value":"this handy tool","position":{"start":{"line":205,"column":271,"offset":10396},"end":{"line":205,"column":286,"offset":10411},"indent":[]}}],"position":{"start":{"line":205,"column":270,"offset":10395},"end":{"line":205,"column":328,"offset":10453},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":205,"column":328,"offset":10453},"end":{"line":205,"column":329,"offset":10454},"indent":[]}}],"position":{"start":{"line":205,"column":1,"offset":10126},"end":{"line":205,"column":329,"offset":10454},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Ensure Drip is called before Rates are changed.","position":{"start":{"line":207,"column":5,"offset":10460},"end":{"line":207,"column":52,"offset":10507},"indent":[]}}],"position":{"start":{"line":207,"column":1,"offset":10456},"end":{"line":207,"column":52,"offset":10507},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Before we change any of the rates, we must call ","position":{"start":{"line":209,"column":1,"offset":10509},"end":{"line":209,"column":49,"offset":10557},"indent":[]}},{"type":"inlineCode","value":"drip()","position":{"start":{"line":209,"column":49,"offset":10557},"end":{"line":209,"column":57,"offset":10565},"indent":[]}},{"type":"text","value":" on those respective contracts (e.g. if this is a DSR rate change, we call ","position":{"start":{"line":209,"column":57,"offset":10565},"end":{"line":209,"column":132,"offset":10640},"indent":[]}},{"type":"inlineCode","value":"drip()","position":{"start":{"line":209,"column":132,"offset":10640},"end":{"line":209,"column":140,"offset":10648},"indent":[]}},{"type":"text","value":" on the ","position":{"start":{"line":209,"column":140,"offset":10648},"end":{"line":209,"column":148,"offset":10656},"indent":[]}},{"type":"inlineCode","value":"pot","position":{"start":{"line":209,"column":148,"offset":10656},"end":{"line":209,"column":153,"offset":10661},"indent":[]}},{"type":"text","value":" or if we are changing the SF of a collateral type, we have to call ","position":{"start":{"line":209,"column":153,"offset":10661},"end":{"line":209,"column":221,"offset":10729},"indent":[]}},{"type":"inlineCode","value":"drip(\"ILK\")","position":{"start":{"line":209,"column":221,"offset":10729},"end":{"line":209,"column":234,"offset":10742},"indent":[]}},{"type":"text","value":" on the ","position":{"start":{"line":209,"column":234,"offset":10742},"end":{"line":209,"column":242,"offset":10750},"indent":[]}},{"type":"inlineCode","value":"jug","position":{"start":{"line":209,"column":242,"offset":10750},"end":{"line":209,"column":247,"offset":10755},"indent":[]}},{"type":"text","value":").","position":{"start":{"line":209,"column":247,"offset":10755},"end":{"line":209,"column":249,"offset":10757},"indent":[]}}],"position":{"start":{"line":209,"column":1,"offset":10509},"end":{"line":209,"column":249,"offset":10757},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"All SpellAction Contract Variables must be declared 'constant'","position":{"start":{"line":211,"column":5,"offset":10763},"end":{"line":211,"column":67,"offset":10825},"indent":[]}}],"position":{"start":{"line":211,"column":1,"offset":10759},"end":{"line":211,"column":67,"offset":10825},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Because of how the ","position":{"start":{"line":213,"column":1,"offset":10827},"end":{"line":213,"column":20,"offset":10846},"indent":[]}},{"type":"inlineCode","value":"SpellAction","position":{"start":{"line":213,"column":20,"offset":10846},"end":{"line":213,"column":33,"offset":10859},"indent":[]}},{"type":"text","value":" is called, it must never have anything in contract memory.  That is, all the variables that look like they are contract variables in the example contract are actually declared as ","position":{"start":{"line":213,"column":33,"offset":10859},"end":{"line":213,"column":213,"offset":11039},"indent":[]}},{"type":"inlineCode","value":"constant","position":{"start":{"line":213,"column":213,"offset":11039},"end":{"line":213,"column":223,"offset":11049},"indent":[]}},{"type":"text","value":".  This is because, at execution time, the contract's variables will be that of the ","position":{"start":{"line":213,"column":223,"offset":11049},"end":{"line":213,"column":307,"offset":11133},"indent":[]}},{"type":"inlineCode","value":"DSPauseProxy","position":{"start":{"line":213,"column":307,"offset":11133},"end":{"line":213,"column":321,"offset":11147},"indent":[]}},{"type":"text","value":".  If there are variables in this section that are anything other than ","position":{"start":{"line":213,"column":321,"offset":11147},"end":{"line":213,"column":392,"offset":11218},"indent":[]}},{"type":"inlineCode","value":"constant","position":{"start":{"line":213,"column":392,"offset":11218},"end":{"line":213,"column":402,"offset":11228},"indent":[]}},{"type":"text","value":" then it is a MAJOR bug.  If this is the case and the spell might look like itâ€™s doing one thing but is actually doing another. and needs to be called out in maker ","position":{"start":{"line":213,"column":402,"offset":11228},"end":{"line":213,"column":566,"offset":11392},"indent":[]}},{"type":"link","title":null,"url":"https://chat.makerdao.com/channel/governance-and-risk","children":[{"type":"text","value":"chat","position":{"start":{"line":213,"column":567,"offset":11393},"end":{"line":213,"column":571,"offset":11397},"indent":[]}}],"position":{"start":{"line":213,"column":566,"offset":11392},"end":{"line":213,"column":627,"offset":11453},"indent":[]}},{"type":"text","value":".  DO NOT vote for a spell with non-constant variables here.","position":{"start":{"line":213,"column":627,"offset":11453},"end":{"line":213,"column":687,"offset":11513},"indent":[]}}],"position":{"start":{"line":213,"column":1,"offset":10827},"end":{"line":213,"column":687,"offset":11513},"indent":[]}},{"type":"export","value":"export const _frontmatter = {}","position":{"start":{"line":216,"column":1,"offset":11516},"end":{"line":216,"column":31,"offset":11546},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":216,"column":31,"offset":11546}}},"scopeImports":["import * as React from 'react'"],"scopeIdentifiers":["React"],"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h1\", null, \"Auditing Executive Spells\"), mdx(\"p\", null, \"This is intended as a guide to help MKR Holders verify executive spells in the Maker Protocol before they vote for them. This document contains three main sections. \"), mdx(\"p\", null, \"First, finding the Contract Code deals with locating the code for the executive in question.\"), mdx(\"p\", null, \"Second, anatomy of a Spell Contract shows examples of the main sections you should expect to see in an executive spell.\"), mdx(\"p\", null, \"Finally, A Non-Exhaustive checklist includes a list of the major things to double check and how to do so.\"), mdx(\"p\", null, \"The key thing to remember is that if any part of an executive spell seems suspicious or confusing in any way it is \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"always\"), \" better to double check before voting. Even if you are mistaken in your concerns, this allows us to add more detail to this document to prevent someone becoming confused in the same way in the future.\"), mdx(\"h2\", null, \"Finding the Contract Code\"), mdx(\"p\", null, \"The link to the spell on etherscan can be found on the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://vote.makerdao.com/\"\n  }), \"voting portal\"), \" in the 'details' pane. Look for the 'source' property.\"), mdx(\"p\", null, \"Once you open the spell in etherscan, click on the Contract tab.\"), mdx(\"p\", null, \"You should see the contract code now. If you are only able to see bytecode (contract is unverified) then the executive should be viewed as potentially malicious. In this case, cry foul in \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://chat.makerdao.com/channel/governance-and-risk\"\n  }), \"chat\"), \" and encourage people NOT to vote for it until the contract code is made available.\"), mdx(\"p\", null, \"For this document, we will be looking at this executive as our source for examples:\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://etherscan.io/address/0xD24FbbB4497AD32308BDa735683B55499Ddc2CaD\"\n  }), \"https://etherscan.io/address/0xD24FbbB4497AD32308BDa735683B55499Ddc2CaD\")), mdx(\"h2\", null, \"Anatomy of an Executive\"), mdx(\"p\", null, \"The meat of each spell is located near the bottom. Most of the stuff at the top are flattened libraries included when the contract was verified.\"), mdx(\"p\", null, \"There are two contracts of note in each executive. These are the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"DssSpell\"), \" contract and the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"SpellAction\"), \" contract.\"), mdx(\"p\", null, \"In our example, the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"DssSpell\"), \" contract is named \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"DssSpell20200221\"), \" in this example and is located at the bottom of the file. Once this spell \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"0xD24FbbB4497AD32308BDa735683B55499Ddc2CaD\"), \" gets enough votes to be \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"lifted\"), \" to the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"hat\"), \", the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"schedule()\"), \" function you see here will be called.\"), mdx(\"p\", null, \"The spell action contract on the other hand includes the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"execute()\"), \" function. This function contains the MCD variable changes that are included in the executive.\"), mdx(\"h3\", null, \"DssSpell\"), mdx(\"h4\", null, \"Contract Variables\"), mdx(\"p\", null, \"Each contract will contain a number of variables to be used in the other functions. In our example, this section looks like this:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"    DSPauseAbstract  public pause =\\n        DSPauseAbstract(0xbE286431454714F511008713973d3B053A2d38f3);\\n    address constant public SAIMOM = 0xF2C5369cFFb8Ea6284452b0326e326DbFdCb867C;\\n    uint256 constant public NEW_FEE = 1000000002877801985002875644; // 9.5%\\n    address          public action;\\n    bytes32          public tag;\\n    uint256          public eta;\\n    bytes            public sig;\\n    bool             public done;\\n\")), mdx(\"h4\", null, \"Constructor\"), mdx(\"p\", null, \"The constructor should always look the same:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"    constructor() public {\\n        sig = abi.encodeWithSignature(\\\"execute()\\\");\\n        action = address(new SpellAction());\\n        bytes32 _tag;\\n        address _action = action;\\n        assembly { _tag := extcodehash(_action) }\\n        tag = _tag\\n    }\\n\")), mdx(\"h4\", null, \"Schedule and Cast\"), mdx(\"p\", null, \"The \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"schedule\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cast\"), \" functions will usually be the same, but for now any SCD changes will be tucked into \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"schedule\"), \". If they deviate from the following, it will be commented:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"    function schedule() public {\\n        require(eta == 0, \\\"spell-already-scheduled\\\");\\n        eta = add(now, DSPauseAbstract(pause).delay());\\n        pause.plot(action, tag, sig, eta);\\n    }\\n\\n    function cast() public {\\n        require(!done, \\\"spell-already-cast\\\");\\n        done = true;\\n        pause.exec(action, tag, sig, eta);\\n    }\\n\")), mdx(\"p\", null, \"After \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"schedule()\"), \" has been called and after the delay is up, anyone can call \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cast()\"), \" which will execute the code in the SpellAction's \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"execute()\"), \" function (see below). \"), mdx(\"h3\", null, \"SpellAction\"), mdx(\"h4\", null, \"Contract Variables\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"uint256 constant RAD = 10 ** 45;\\naddress constant public PAUSE = 0xbE286431454714F511008713973d3B053A2d38f3;\\naddress constant public CHIEF = 0x9eF05f7F6deB616fd37aC3c959a2dDD25A54E4F5;\\naddress constant public OSM_MOM = 0x76416A4d5190d071bfed309861527431304aA14f;\\naddress constant public ETH_OSM = 0x81FE72B5A8d1A857d176C3E7d5Bd2679A9B85763;\\naddress constant public BAT_OSM = 0xB4eb54AF9Cc7882DF0121d26c5b97E802915ABe6;\\naddress constant public VAT = 0x35D1b3F3D7966A1DFe207aa4514C12a259A0492B;\\naddress constant public JUG = 0x19c0976f590D67707E62397C87829d896Dc0f1F1;\\naddress constant public POT = 0x197E90f9FAD81970bA7976f33CbD77088E5D7cf7;\\naddress constant public FLAP = 0xdfE0fb1bE2a52CDBf8FB962D5701d7fd0902db9f;\\nuint256 constant NEW_BEG = 1.02E18; // 2%\\n\")), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"NOTE:\"), \" Review \\\"All SpellAction Contract Variables must be declared 'constant'\\\" in the checklist section below.\"), mdx(\"h4\", null, \"Execute\"), mdx(\"p\", null, \"The \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"execute()\"), \" function will contain each MCD change that is being made in this executive spell.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"    function execute() external {\\n        // drip\\n        PotAbstract(POT).drip();\\n        JugAbstract(JUG).drip(\\\"ETH-A\\\");\\n        JugAbstract(JUG).drip(\\\"BAT-A\\\");\\n\\n        // set the global debt ceiling to 183,000,000\\n        VatAbstract(VAT).file(\\\"Line\\\", mul(183000000, RAD));\\n\\n        // set the ETH-A debt ceiling to 150,000,000\\n        // https://vote.makerdao.com/polling-proposal/qmsm1q1hohyctsgxpbm44fomjoukf1d5g9lmpqraikmeoc\\n        VatAbstract(VAT).file(\\\"ETH-A\\\", \\\"line\\\", mul(150000000, RAD));\\n\\n        // No Sai debt ceiling change this week.\\n\\n        // set dsr to 8.0%\\n        // Previously ETH SF was set to 8.0%, no change this week.\\n        //  DSR rate was voted to a 0% spread, so we're bringing DSR up to match.\\n        // https://vote.makerdao.com/polling-proposal/qmss9hnszwr6egq3xn6gpx4u8bz8cajja56rgtanjev1v8\\n        PotAbstract(POT).file(\\\"dsr\\\", 1000000002440418608258400030);\\n\\n        // MCD Stability fee is currently at 8% and remains the same this week.\\n        // https://vote.makerdao.com/polling-proposal/qmzgvzjm4xpm4b1tk2hxhdc6p8f4zqyju38pwqieatmhel\\n\\n        // Lower the minimum flap auction bid increase to 2%\\n        // https://vote.makerdao.com/polling-proposal/qmtsxrqavtczfsseytpypgqrz6z8zb613ikxwhqjv9ytzz\\n        FlapAbstract(FLAP).file(\\\"beg\\\", NEW_BEG);\\n\\n        // Increase the Pause to 24 Hours\\n        OsmAbstract(ETH_OSM).rely(OSM_MOM);\\n        OsmAbstract(BAT_OSM).rely(OSM_MOM);\\n        OsmMomAbstract(OSM_MOM).setAuthority(CHIEF);\\n        OsmMomAbstract(OSM_MOM).setOsm(\\\"ETH-A\\\", ETH_OSM);\\n        OsmMomAbstract(OSM_MOM).setOsm(\\\"BAT-A\\\", BAT_OSM);\\n        DSPauseAbstract(PAUSE).setDelay(60 * 60 * 24);\\n   }\\n\")), mdx(\"p\", null, \"The \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"execute()\"), \" function will be too large to go into detail, but each change should be well documented and one should make sure the code does what the comment says. \"), mdx(\"h2\", null, \"A Non-exhaustive Checklist\"), mdx(\"h3\", null, \"Verify that the contract code is visible.\"), mdx(\"p\", null, \"Using the instructions above find the contract code on Etherscan and ensure that it is visible and verified.\"), mdx(\"h3\", null, \"Verify the Constructor, the Schedule, and the Cast functions mach templates.\"), mdx(\"p\", null, \"Each of these functions should match the templates shown above unless comments are included with the changes explaining why they do not conform to the expected templates.\"), mdx(\"h3\", null, \"Verify that the contents of the execute function are as expected\"), mdx(\"p\", null, \"Make sure that you are seeing what you expected to see from the voting dashboard. \"), mdx(\"p\", null, \"Ensure that everything present is correct and that nothing is missing from this function.\"), mdx(\"h3\", null, \"Verify all addresses against the changelog\"), mdx(\"p\", null, \"Any addresses you see in either of the above contracts should be verified against the most recent mainnet changelog.  Currently MCD is at version \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"1.0.5\"), \", and the address list can be found here:\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://changelog.makerdao.com/releases/mainnet/1.0.5/contracts.json\"\n  }), \"https://changelog.makerdao.com/releases/mainnet/1.0.5/contracts.json\")), mdx(\"p\", null, \"To find the latest release you can look at \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://changelog.makerdao.com/\"\n  }), \"https://changelog.makerdao.com/\")), mdx(\"p\", null, \"In order to verify these, you should ensure that each address in the contract matches one of the addresses in the changelog.\"), mdx(\"p\", null, \"Note that in the example spell, there were SCD changes. Those are well documented and done with SaiMomAbstract(SAIMOM).setFee(NEW_FEE);. This calls a contract that has privileged access to make a few configuration changes in SCD. \"), mdx(\"p\", null, \"Verify the address of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"SAIMOM\"), \" from the contract definition above. This is trickier, but you can put the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"SAIMOM\"), \" address into etherscan: \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://etherscan.io/address/0xF2C5369cFFb8Ea6284452b0326e326DbFdCb867C#code\"\n  }), \"https://etherscan.io/address/0xF2C5369cFFb8Ea6284452b0326e326DbFdCb867C#code\")), mdx(\"h4\", null, \"Verifying Oracle Addresses\"), mdx(\"p\", null, \"Occasionally, there are spells to do with Oracles - generally adding addresses to the whitelist, and occasionally adding a new kind of oracle (most recently the BTCUSD one). These addresses must also be carefully verified, and it can be non-obvious how to do so. However, if you follow the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://changelog.makerdao.com/releases/mainnet/1.0.5/contracts.json\"\n  }), \"link to the changelog\"), \" and look for \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"PIP_ETH\"), \", you'll be on the right track.\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Open the \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"Read\"), \" tab of the \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://etherscan.io/address/0x81FE72B5A8d1A857d176C3E7d5Bd2679A9B85763#code\"\n  }), mdx(\"inlineCode\", {\n    parentName: \"a\"\n  }, \"PIP_ETH\")), \" contract.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Look for \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"src\"), \" (listed as number \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"7\"), \" currently).\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Follow \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://etherscan.io/address/0x64de91f5a373cd4c28de3600cb34c7c6ce410c85#code\"\n  }), \"the contract address listed there\"), \" and verify that it is indeed the \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"MedianETHUSD\"), \"contract, and that the address here matches what is in the spell.\")), mdx(\"h3\", null, \"Verify Rate Changes\"), mdx(\"p\", null, \"Rates are defined as per-second accumulation values. These values can be validated against the commented rate by using the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"bc\"), \" command in a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"bash\"), \" shell. Using the NEW_FEE variable in the example contract we have:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"bc -l <<< 'scale=27; e( l(1.095)/(60 * 60 * 24 * 365) )'\\n\")), mdx(\"p\", null, \"This produces \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"1.000000002877801985002875644\"), \", just drop the decimal place and you can see this matches the definition of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"NEW_FEE\"), \".\"), mdx(\"p\", null, \"Validating all rate adjustments can be done the same way.\"), mdx(\"p\", null, \"For more information on the rates module, @vamsi wrote up a great post here: \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/makerdao/developerguides/blob/master/mcd/intro-rate-mechanism/intro-rate-mechanism.mdare\"\n  }), \"https://github.com/makerdao/developerguides/blob/master/mcd/intro-rate-mechanism/intro-rate-mechanism.mdare\"), \" set to go off\"), mdx(\"h3\", null, \"Verify Timing\"), mdx(\"p\", null, \"Occasionally, spells are set to execute at specific times, as in the case of \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://etherscan.io/address/0x3526A5858Aa91C058A7084ae8AB6d323D2BaeBB8#code\"\n  }), \"shutting down SCD\"), \" (check line 71 for an example). You can verify any UTC timestamp created in such spells using \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.unixtimestamp.com/index.php\"\n  }), \"this handy tool\"), \".\"), mdx(\"h3\", null, \"Ensure Drip is called before Rates are changed.\"), mdx(\"p\", null, \"Before we change any of the rates, we must call \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"drip()\"), \" on those respective contracts (e.g. if this is a DSR rate change, we call \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"drip()\"), \" on the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"pot\"), \" or if we are changing the SF of a collateral type, we have to call \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"drip(\\\"ILK\\\")\"), \" on the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"jug\"), \").\"), mdx(\"h3\", null, \"All SpellAction Contract Variables must be declared 'constant'\"), mdx(\"p\", null, \"Because of how the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"SpellAction\"), \" is called, it must never have anything in contract memory.  That is, all the variables that look like they are contract variables in the example contract are actually declared as \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"constant\"), \".  This is because, at execution time, the contract's variables will be that of the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"DSPauseProxy\"), \".  If there are variables in this section that are anything other than \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"constant\"), \" then it is a MAJOR bug.  If this is the case and the spell might look like it\\u2019s doing one thing but is actually doing another. and needs to be called out in maker \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://chat.makerdao.com/channel/governance-and-risk\"\n  }), \"chat\"), \".  DO NOT vote for a spell with non-constant variables here.\"));\n}\n;\nMDXContent.isMDXComponent = true;","rawMDXOutput":"/* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nexport const _frontmatter = {};\n\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <h1>{`Auditing Executive Spells`}</h1>\n    <p>{`This is intended as a guide to help MKR Holders verify executive spells in the Maker Protocol before they vote for them. This document contains three main sections. `}</p>\n    <p>{`First, finding the Contract Code deals with locating the code for the executive in question.`}</p>\n    <p>{`Second, anatomy of a Spell Contract shows examples of the main sections you should expect to see in an executive spell.`}</p>\n    <p>{`Finally, A Non-Exhaustive checklist includes a list of the major things to double check and how to do so.`}</p>\n    <p>{`The key thing to remember is that if any part of an executive spell seems suspicious or confusing in any way it is `}<strong parentName=\"p\">{`always`}</strong>{` better to double check before voting. Even if you are mistaken in your concerns, this allows us to add more detail to this document to prevent someone becoming confused in the same way in the future.`}</p>\n    <h2>{`Finding the Contract Code`}</h2>\n    <p>{`The link to the spell on etherscan can be found on the `}<a parentName=\"p\" {...{\n        \"href\": \"https://vote.makerdao.com/\"\n      }}>{`voting portal`}</a>{` in the 'details' pane. Look for the 'source' property.`}</p>\n    <p>{`Once you open the spell in etherscan, click on the Contract tab.`}</p>\n    <p>{`You should see the contract code now. If you are only able to see bytecode (contract is unverified) then the executive should be viewed as potentially malicious. In this case, cry foul in `}<a parentName=\"p\" {...{\n        \"href\": \"https://chat.makerdao.com/channel/governance-and-risk\"\n      }}>{`chat`}</a>{` and encourage people NOT to vote for it until the contract code is made available.`}</p>\n    <p>{`For this document, we will be looking at this executive as our source for examples:\n`}<a parentName=\"p\" {...{\n        \"href\": \"https://etherscan.io/address/0xD24FbbB4497AD32308BDa735683B55499Ddc2CaD\"\n      }}>{`https://etherscan.io/address/0xD24FbbB4497AD32308BDa735683B55499Ddc2CaD`}</a></p>\n    <h2>{`Anatomy of an Executive`}</h2>\n    <p>{`The meat of each spell is located near the bottom. Most of the stuff at the top are flattened libraries included when the contract was verified.`}</p>\n    <p>{`There are two contracts of note in each executive. These are the `}<inlineCode parentName=\"p\">{`DssSpell`}</inlineCode>{` contract and the `}<inlineCode parentName=\"p\">{`SpellAction`}</inlineCode>{` contract.`}</p>\n    <p>{`In our example, the `}<inlineCode parentName=\"p\">{`DssSpell`}</inlineCode>{` contract is named `}<inlineCode parentName=\"p\">{`DssSpell20200221`}</inlineCode>{` in this example and is located at the bottom of the file. Once this spell `}<inlineCode parentName=\"p\">{`0xD24FbbB4497AD32308BDa735683B55499Ddc2CaD`}</inlineCode>{` gets enough votes to be `}<inlineCode parentName=\"p\">{`lifted`}</inlineCode>{` to the `}<inlineCode parentName=\"p\">{`hat`}</inlineCode>{`, the `}<inlineCode parentName=\"p\">{`schedule()`}</inlineCode>{` function you see here will be called.`}</p>\n    <p>{`The spell action contract on the other hand includes the `}<inlineCode parentName=\"p\">{`execute()`}</inlineCode>{` function. This function contains the MCD variable changes that are included in the executive.`}</p>\n    <h3>{`DssSpell`}</h3>\n    <h4>{`Contract Variables`}</h4>\n    <p>{`Each contract will contain a number of variables to be used in the other functions. In our example, this section looks like this:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`    DSPauseAbstract  public pause =\n        DSPauseAbstract(0xbE286431454714F511008713973d3B053A2d38f3);\n    address constant public SAIMOM = 0xF2C5369cFFb8Ea6284452b0326e326DbFdCb867C;\n    uint256 constant public NEW_FEE = 1000000002877801985002875644; // 9.5%\n    address          public action;\n    bytes32          public tag;\n    uint256          public eta;\n    bytes            public sig;\n    bool             public done;\n`}</code></pre>\n    <h4>{`Constructor`}</h4>\n    <p>{`The constructor should always look the same:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`    constructor() public {\n        sig = abi.encodeWithSignature(\"execute()\");\n        action = address(new SpellAction());\n        bytes32 _tag;\n        address _action = action;\n        assembly { _tag := extcodehash(_action) }\n        tag = _tag\n    }\n`}</code></pre>\n    <h4>{`Schedule and Cast`}</h4>\n    <p>{`The `}<inlineCode parentName=\"p\">{`schedule`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`cast`}</inlineCode>{` functions will usually be the same, but for now any SCD changes will be tucked into `}<inlineCode parentName=\"p\">{`schedule`}</inlineCode>{`. If they deviate from the following, it will be commented:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`    function schedule() public {\n        require(eta == 0, \"spell-already-scheduled\");\n        eta = add(now, DSPauseAbstract(pause).delay());\n        pause.plot(action, tag, sig, eta);\n    }\n\n    function cast() public {\n        require(!done, \"spell-already-cast\");\n        done = true;\n        pause.exec(action, tag, sig, eta);\n    }\n`}</code></pre>\n    <p>{`After `}<inlineCode parentName=\"p\">{`schedule()`}</inlineCode>{` has been called and after the delay is up, anyone can call `}<inlineCode parentName=\"p\">{`cast()`}</inlineCode>{` which will execute the code in the SpellAction's `}<inlineCode parentName=\"p\">{`execute()`}</inlineCode>{` function (see below). `}</p>\n    <h3>{`SpellAction`}</h3>\n    <h4>{`Contract Variables`}</h4>\n    <pre><code parentName=\"pre\" {...{}}>{`uint256 constant RAD = 10 ** 45;\naddress constant public PAUSE = 0xbE286431454714F511008713973d3B053A2d38f3;\naddress constant public CHIEF = 0x9eF05f7F6deB616fd37aC3c959a2dDD25A54E4F5;\naddress constant public OSM_MOM = 0x76416A4d5190d071bfed309861527431304aA14f;\naddress constant public ETH_OSM = 0x81FE72B5A8d1A857d176C3E7d5Bd2679A9B85763;\naddress constant public BAT_OSM = 0xB4eb54AF9Cc7882DF0121d26c5b97E802915ABe6;\naddress constant public VAT = 0x35D1b3F3D7966A1DFe207aa4514C12a259A0492B;\naddress constant public JUG = 0x19c0976f590D67707E62397C87829d896Dc0f1F1;\naddress constant public POT = 0x197E90f9FAD81970bA7976f33CbD77088E5D7cf7;\naddress constant public FLAP = 0xdfE0fb1bE2a52CDBf8FB962D5701d7fd0902db9f;\nuint256 constant NEW_BEG = 1.02E18; // 2%\n`}</code></pre>\n    <p><strong parentName=\"p\">{`NOTE:`}</strong>{` Review \"All SpellAction Contract Variables must be declared 'constant'\" in the checklist section below.`}</p>\n    <h4>{`Execute`}</h4>\n    <p>{`The `}<inlineCode parentName=\"p\">{`execute()`}</inlineCode>{` function will contain each MCD change that is being made in this executive spell.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`    function execute() external {\n        // drip\n        PotAbstract(POT).drip();\n        JugAbstract(JUG).drip(\"ETH-A\");\n        JugAbstract(JUG).drip(\"BAT-A\");\n\n        // set the global debt ceiling to 183,000,000\n        VatAbstract(VAT).file(\"Line\", mul(183000000, RAD));\n\n        // set the ETH-A debt ceiling to 150,000,000\n        // https://vote.makerdao.com/polling-proposal/qmsm1q1hohyctsgxpbm44fomjoukf1d5g9lmpqraikmeoc\n        VatAbstract(VAT).file(\"ETH-A\", \"line\", mul(150000000, RAD));\n\n        // No Sai debt ceiling change this week.\n\n        // set dsr to 8.0%\n        // Previously ETH SF was set to 8.0%, no change this week.\n        //  DSR rate was voted to a 0% spread, so we're bringing DSR up to match.\n        // https://vote.makerdao.com/polling-proposal/qmss9hnszwr6egq3xn6gpx4u8bz8cajja56rgtanjev1v8\n        PotAbstract(POT).file(\"dsr\", 1000000002440418608258400030);\n\n        // MCD Stability fee is currently at 8% and remains the same this week.\n        // https://vote.makerdao.com/polling-proposal/qmzgvzjm4xpm4b1tk2hxhdc6p8f4zqyju38pwqieatmhel\n\n        // Lower the minimum flap auction bid increase to 2%\n        // https://vote.makerdao.com/polling-proposal/qmtsxrqavtczfsseytpypgqrz6z8zb613ikxwhqjv9ytzz\n        FlapAbstract(FLAP).file(\"beg\", NEW_BEG);\n\n        // Increase the Pause to 24 Hours\n        OsmAbstract(ETH_OSM).rely(OSM_MOM);\n        OsmAbstract(BAT_OSM).rely(OSM_MOM);\n        OsmMomAbstract(OSM_MOM).setAuthority(CHIEF);\n        OsmMomAbstract(OSM_MOM).setOsm(\"ETH-A\", ETH_OSM);\n        OsmMomAbstract(OSM_MOM).setOsm(\"BAT-A\", BAT_OSM);\n        DSPauseAbstract(PAUSE).setDelay(60 * 60 * 24);\n   }\n`}</code></pre>\n    <p>{`The `}<inlineCode parentName=\"p\">{`execute()`}</inlineCode>{` function will be too large to go into detail, but each change should be well documented and one should make sure the code does what the comment says. `}</p>\n    <h2>{`A Non-exhaustive Checklist`}</h2>\n    <h3>{`Verify that the contract code is visible.`}</h3>\n    <p>{`Using the instructions above find the contract code on Etherscan and ensure that it is visible and verified.`}</p>\n    <h3>{`Verify the Constructor, the Schedule, and the Cast functions mach templates.`}</h3>\n    <p>{`Each of these functions should match the templates shown above unless comments are included with the changes explaining why they do not conform to the expected templates.`}</p>\n    <h3>{`Verify that the contents of the execute function are as expected`}</h3>\n    <p>{`Make sure that you are seeing what you expected to see from the voting dashboard. `}</p>\n    <p>{`Ensure that everything present is correct and that nothing is missing from this function.`}</p>\n    <h3>{`Verify all addresses against the changelog`}</h3>\n    <p>{`Any addresses you see in either of the above contracts should be verified against the most recent mainnet changelog.  Currently MCD is at version `}<inlineCode parentName=\"p\">{`1.0.5`}</inlineCode>{`, and the address list can be found here:\n`}<a parentName=\"p\" {...{\n        \"href\": \"https://changelog.makerdao.com/releases/mainnet/1.0.5/contracts.json\"\n      }}>{`https://changelog.makerdao.com/releases/mainnet/1.0.5/contracts.json`}</a></p>\n    <p>{`To find the latest release you can look at `}<a parentName=\"p\" {...{\n        \"href\": \"https://changelog.makerdao.com/\"\n      }}>{`https://changelog.makerdao.com/`}</a></p>\n    <p>{`In order to verify these, you should ensure that each address in the contract matches one of the addresses in the changelog.`}</p>\n    <p>{`Note that in the example spell, there were SCD changes. Those are well documented and done with SaiMomAbstract(SAIMOM).setFee(NEW_FEE);. This calls a contract that has privileged access to make a few configuration changes in SCD. `}</p>\n    <p>{`Verify the address of `}<inlineCode parentName=\"p\">{`SAIMOM`}</inlineCode>{` from the contract definition above. This is trickier, but you can put the `}<inlineCode parentName=\"p\">{`SAIMOM`}</inlineCode>{` address into etherscan: `}<a parentName=\"p\" {...{\n        \"href\": \"https://etherscan.io/address/0xF2C5369cFFb8Ea6284452b0326e326DbFdCb867C#code\"\n      }}>{`https://etherscan.io/address/0xF2C5369cFFb8Ea6284452b0326e326DbFdCb867C#code`}</a></p>\n    <h4>{`Verifying Oracle Addresses`}</h4>\n    <p>{`Occasionally, there are spells to do with Oracles - generally adding addresses to the whitelist, and occasionally adding a new kind of oracle (most recently the BTCUSD one). These addresses must also be carefully verified, and it can be non-obvious how to do so. However, if you follow the `}<a parentName=\"p\" {...{\n        \"href\": \"https://changelog.makerdao.com/releases/mainnet/1.0.5/contracts.json\"\n      }}>{`link to the changelog`}</a>{` and look for `}<inlineCode parentName=\"p\">{`PIP_ETH`}</inlineCode>{`, you'll be on the right track.`}</p>\n    <ol>\n      <li parentName=\"ol\">{`Open the `}<inlineCode parentName=\"li\">{`Read`}</inlineCode>{` tab of the `}<a parentName=\"li\" {...{\n          \"href\": \"https://etherscan.io/address/0x81FE72B5A8d1A857d176C3E7d5Bd2679A9B85763#code\"\n        }}><inlineCode parentName=\"a\">{`PIP_ETH`}</inlineCode></a>{` contract.`}</li>\n      <li parentName=\"ol\">{`Look for `}<inlineCode parentName=\"li\">{`src`}</inlineCode>{` (listed as number `}<inlineCode parentName=\"li\">{`7`}</inlineCode>{` currently).`}</li>\n      <li parentName=\"ol\">{`Follow `}<a parentName=\"li\" {...{\n          \"href\": \"https://etherscan.io/address/0x64de91f5a373cd4c28de3600cb34c7c6ce410c85#code\"\n        }}>{`the contract address listed there`}</a>{` and verify that it is indeed the `}<inlineCode parentName=\"li\">{`MedianETHUSD`}</inlineCode>{`contract, and that the address here matches what is in the spell.`}</li>\n    </ol>\n    <h3>{`Verify Rate Changes`}</h3>\n    <p>{`Rates are defined as per-second accumulation values. These values can be validated against the commented rate by using the `}<inlineCode parentName=\"p\">{`bc`}</inlineCode>{` command in a `}<inlineCode parentName=\"p\">{`bash`}</inlineCode>{` shell. Using the NEW_FEE variable in the example contract we have:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`bc -l <<< 'scale=27; e( l(1.095)/(60 * 60 * 24 * 365) )'\n`}</code></pre>\n    <p>{`This produces `}<inlineCode parentName=\"p\">{`1.000000002877801985002875644`}</inlineCode>{`, just drop the decimal place and you can see this matches the definition of `}<inlineCode parentName=\"p\">{`NEW_FEE`}</inlineCode>{`.`}</p>\n    <p>{`Validating all rate adjustments can be done the same way.`}</p>\n    <p>{`For more information on the rates module, @vamsi wrote up a great post here: `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/makerdao/developerguides/blob/master/mcd/intro-rate-mechanism/intro-rate-mechanism.mdare\"\n      }}>{`https://github.com/makerdao/developerguides/blob/master/mcd/intro-rate-mechanism/intro-rate-mechanism.mdare`}</a>{` set to go off`}</p>\n    <h3>{`Verify Timing`}</h3>\n    <p>{`Occasionally, spells are set to execute at specific times, as in the case of `}<a parentName=\"p\" {...{\n        \"href\": \"https://etherscan.io/address/0x3526A5858Aa91C058A7084ae8AB6d323D2BaeBB8#code\"\n      }}>{`shutting down SCD`}</a>{` (check line 71 for an example). You can verify any UTC timestamp created in such spells using `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.unixtimestamp.com/index.php\"\n      }}>{`this handy tool`}</a>{`.`}</p>\n    <h3>{`Ensure Drip is called before Rates are changed.`}</h3>\n    <p>{`Before we change any of the rates, we must call `}<inlineCode parentName=\"p\">{`drip()`}</inlineCode>{` on those respective contracts (e.g. if this is a DSR rate change, we call `}<inlineCode parentName=\"p\">{`drip()`}</inlineCode>{` on the `}<inlineCode parentName=\"p\">{`pot`}</inlineCode>{` or if we are changing the SF of a collateral type, we have to call `}<inlineCode parentName=\"p\">{`drip(\"ILK\")`}</inlineCode>{` on the `}<inlineCode parentName=\"p\">{`jug`}</inlineCode>{`).`}</p>\n    <h3>{`All SpellAction Contract Variables must be declared 'constant'`}</h3>\n    <p>{`Because of how the `}<inlineCode parentName=\"p\">{`SpellAction`}</inlineCode>{` is called, it must never have anything in contract memory.  That is, all the variables that look like they are contract variables in the example contract are actually declared as `}<inlineCode parentName=\"p\">{`constant`}</inlineCode>{`.  This is because, at execution time, the contract's variables will be that of the `}<inlineCode parentName=\"p\">{`DSPauseProxy`}</inlineCode>{`.  If there are variables in this section that are anything other than `}<inlineCode parentName=\"p\">{`constant`}</inlineCode>{` then it is a MAJOR bug.  If this is the case and the spell might look like itâ€™s doing one thing but is actually doing another. and needs to be called out in maker `}<a parentName=\"p\" {...{\n        \"href\": \"https://chat.makerdao.com/channel/governance-and-risk\"\n      }}>{`chat`}</a>{`.  DO NOT vote for a spell with non-constant variables here.`}</p>\n\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;"}}